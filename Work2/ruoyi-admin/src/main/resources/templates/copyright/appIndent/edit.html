<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" >
<head>
	<th:block th:include="include :: header('修改订单')" />
	<th:block th:include="include :: select2-css" />
</head>
<body class="white-bg">
    <div class="wrapper wrapper-content animated fadeInRight ibox-content">
        <form class="form-horizontal m" id="form-appIndent-edit" th:object="${appIndent}">
            <input id="indentId" name="indentId" th:field="*{indentId}"  type="hidden">
			<!-- <div class="form-group">	
				<label class="col-sm-3 control-label">关联产品表：</label>
				<div class="col-sm-8">
					<input id="product" name="product" th:field="*{product}" class="form-control" type="text">
				</div>
			</div> -->
			 <!-- <div class="form-group">	
				<label class="col-sm-3 control-label">选择产品：</label>
				<div class="col-sm-8">
                    <select name="product" class="form-control m-b"  >
                       <option th:each="product :${pro}"
                         th:value="${product.type}" th:text="${product.type}"  >
                       </option>
                    </select>
				</div>
			</div> -->
			
			
			<!-- <div class="form-group">	
				<label class="col-sm-3 control-label">订单类型：</label>
				<div class="col-sm-8">
					<input id="indentId" name="indentId" th:field="*{indentId}" class="form-control" type="text">
				</div>
			</div> -->
			
			<!-- <div class="form-group">
			<label class="col-sm-3 control-label">订单类型：</label>
				<div class="col-sm-8">
					<select name="indentType" class="form-control m-b" 
					th:with="type=${@dict.getType('app_indent_type')}">
	                    <option th:each="dict : ${type}" th:text="${dict.dictLabel}" 
	                    th:value="${dict.dictValue}" 
	                    th:selected="${dict.dictValue==indentType}"></option>
	                </select>
				</div>
			</div> -->
			<div class="form-group">
			   <label class="col-sm-3 control-label">订单类型：</label>
				<div class="col-sm-8">
					<select name="indentType" class="form-control m-b" th:with="type=${@dict.getType('app_indent_type')}">
	                    <option th:each="dict : ${type}" th:text="${dict.dictLabel}" th:value="${dict.dictValue}" ></option>
	                </select>
				</div>
			</div>
			
			
			<div class="form-group">	
				<label class="col-sm-3 control-label">订单编号：</label>
				<div class="col-sm-8">
					<input id="code" name="code" th:field="*{code}" class="form-control" type="text"  >
				</div>
			</div>
			<div class="form-group">	
				<label class="col-sm-3 control-label">关联客户表：</label>
				<div class="col-sm-8">
					<input id="clientId" name="clientId" th:field="*{clientId}" class="form-control" type="text">
				</div>
			</div>
			<div class="form-group">	
				<label class="col-sm-3 control-label">订购日期：</label>
				<div class="col-sm-8">
					<input id="purchaseDate" name="purchaseDate" th:field="*{purchaseDate}" class="time-input" type="text">
				</div>
			</div>
			<div class="form-group">	
				<label class="col-sm-3 control-label">订单金额：</label>
				<div class="col-sm-8">
					<input id="orderAmount" name="orderAmount" th:field="*{orderAmount}" class="form-control" type="number">
				</div>
			</div>
			
			<!-- <div class="form-group">	
				<label class="col-sm-3 control-label">折扣：</label>
				<div class="col-sm-8">
					<input id="discount" name="discount" th:field="*{discount}"class="form-control" type="text">
				</div>
			</div> -->
			<!-- <div class="form-group">	
				<label class="col-sm-3 control-label">材料：</label>
				<div class="col-sm-8">
					<input id="materials" name="materials" th:field="*{materials}" class="form-control" type="text">
				</div>
			</div> -->
			
				<div class="form-group">	<!-- 单选框 -->
				<label class="col-sm-3 control-label">有无材料：</label>
				<div class="col-sm-8">
					<!-- <input id="materials" name="materials" class="form-control" type="text"> -->
					<label class="radio-box"> 
					<input type="radio" checked
						value="0" id="optionsRadios2" name="materials"> <ins
							class="iCheck-helper"
							style="position: absolute; display: block; width: 100%; height: 100%;  background: rgb(255, 255, 255); border: 0px; opacity: 0;"></ins>
						无材料
					</label>
					<label class="radio-box">
					 <input type="radio" 
						value="1" id="optionsRadios1" name="materials"> <ins
							class="iCheck-helper"
							style="position: absolute;  display: block; width: 100%; height: 100%; background: rgb(255, 255, 255); border: 0px; opacity: 0;"></ins>
						有材料
					</label> 
					
				</div>
			</div>
			
			<div class="form-group">	
				<label class="col-sm-3 control-label">发票：</label>
				<div class="col-sm-9">
				   <label class="radio-box"> 
					<input type="radio" checked
						value="0" id="optionsRadios2" name="invoice"> <ins
							class="iCheck-helper"
							style="position: absolute; display: block; width: 100%; height: 100%;  background: rgb(255, 255, 255); border: 0px; opacity: 0;"></ins>
						无需
					</label>
					<label class="radio-box">
					 <input type="radio" 
						value="1" id="optionsRadios1" name="invoice"> <ins
							class="iCheck-helper"
							style="position: absolute;  display: block; width: 100%; height: 100%; background: rgb(255, 255, 255); border: 0px; opacity: 0;"></ins>
						普票
					</label> 
				    <label class="radio-box">
					 <input type="radio" 
						value="2" id="optionsRadios3" name="invoice"> <ins
							class="iCheck-helper"
							style="position: absolute;  display: block; width: 100%; height: 100%; background: rgb(255, 255, 255); border: 0px; opacity: 0;"></ins>
						专票
					</label> 
			
				</div>
			</div>
			
			
			<div class="form-group">	
				<label class="col-sm-3 control-label">备注：</label>
				<div class="col-sm-8">
					<input id="remark" name="remark" th:field="*{remark}" class="form-control" type="text">
				</div>
			</div>
			<!-- <div class="form-group">	
				<label class="col-sm-3 control-label">订单状态：</label>
				<div class="col-sm-8">
					<input id="orderStatus" name="orderStatus" th:field="*{orderStatus}" class="form-control" type="text">
				</div>
			</div>
			 -->
			<div class="form-group">	
				<label class="col-sm-3 control-label">订单状态：</label>
				<div class="col-sm-8">
            		<select id="orderStatus" name="orderStatus"  class="form-control m-b" th:with="type=${@dict.getType('app_indent_status')}">
                      <option th:each="dict : ${type}" th:text="${dict.dictLabel}" th:value="${dict.dictValue}" ></option>
                  </select>
       			 </div> 
				
			</div>
			<!-- <div class="form-group">	
				<label class="col-sm-3 control-label">发货时间：</label>
				<div class="col-sm-8">
					<input id="deliveryTime" name="deliveryTime" th:field="*{deliveryTime}" class="time-input" type="text">
				</div>
			</div> -->
			<!-- <div class="form-group">	
				<label class="col-sm-3 control-label">快递单号：</label>
				<div class="col-sm-8">
					<input id="trackingNumber" name="trackingNumber" th:field="*{trackingNumber}" class="form-control" type="text">
				</div>
			</div> -->
			<!-- <div class="form-group">	
				<label class="col-sm-3 control-label">服务情况：</label>
				<div class="col-sm-8">
					<input id="serviceCondition" name="serviceCondition" th:field="*{serviceCondition}" class="form-control" type="text">
				</div>
			</div> -->
			<div class="form-group">	
				<label class="col-sm-3 control-label">创建人：</label>
				<div class="col-sm-8">
					<input id="creator" name="creator" th:field="*{creator}" class="form-control" type="text">
				</div>
			</div>
			<div class="form-group">	
				<label class="col-sm-3 control-label">创建时间：</label>
				<div class="col-sm-8">
					<input id="creationTime" name="creationTime" th:field="*{creationTime}" class="time-input" type="text" >
				</div>
			</div>		
		</form>
		
		<h4 class="form-header h4">产品清单：</h4>
		<div id="detdiv">
		<form id="form-appDetailed-add" class="detailForm form-inline">
		
		<div class="form-group"><a id = "delspan"  class="get btn btn-danger btn-xs">删除</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<label class="form-group">产品：</label>		
		<input id="product" name="product" type="text"  /></div> 
		<!-- <select id="detailselect" name="product"  style="width:100px">
	           <option th:each="product :${pro}" th:value="${product}" th:text="${product}"  >          
	           </option>
	    </select>	 -->  
	      <div class="form-group"> <label class="control-label">软件(作品)名字：</label><input id="worksName" name="worksName" type="text" class="form-control" /></div>
	    <div class="form-group"><label class="control-label">价格：</label><input id="price" name="price" type="number" class="form-control"  /></div>
	    <!-- <div class="form-group"><label class="control-label">数量：</label><input id="amount" name="amount" type="number" class="form-control"   /></div> -->
	    <!-- <label>发货时间：</label><input id="deliveryTime" name="deliveryTime" type="text" class="time-input"  style="width:100px" /> -->
	    <div class="form-group"><label class="control-label">是否代写：</label><input id="ghostWrite" name="ghostWrite" type="text" class="form-control" /></div>
	    <div class="form-group"><label class="control-label">递交日期：</label><input id="submitTime" name="submitTime" type="text" class="form-control" /></div>  
        <div class="form-group"><label class="control-label">发货日期：</label><input id="deliveryTime" name="deliveryTime" type="text" class="form-control" /></div>  
	    <div class="form-group"> <label class="control-label">流水号：</label><input id="serialsNumber" name="serialsNumber" type="text" class="form-control" /></div>
	    <div class="form-group"><label class="control-label">快递单号：</label><input id="trackingNumber" name="trackingNumber" type="text" class="form-control" /></div>        
	    <input id="detailedId" name="detailedId" type="text"  style="display:none">	     
		</form>
		</div>
    </div>
    
    <div th:include="include::footer"></div>
    <script type="text/javascript">
		var prefix = ctx + "copyright/appIndent";
		var prefixd = ctx + "copyright/appDetailed";
		$("#form-appIndent-edit").validate({
			rules:{
				xxxx:{
					required:true,
				},
			},
			focusCleanup: true
		});
		
		function submitHandler() {
	        if ($.validate.form()) {
	            $.operate.save(prefix + "/edit", $('#form-appIndent-edit').serialize());
	            
	            var cod = $('#code').val();
				var n =  $(".detailForm").length;	
	            for(var i = 0;i < n;i++){
					var b = $($('.detailForm')[i]).serialize()+'&coded='+cod;
				 $.operate.savedet(prefixd + "/edit", b);    //修改清单的
				 }
	        }
	    }
		$('#detdiv').on("click",".get",function(){		 //清单的删除按钮 	
			 if($(".detailForm").length <= 1){		 
			 }else{ 	
				 alert("是否删除？");
				 $(this).parent().remove();
				 alert($(this).find("#detailedId").val());
				 alert($(this).parent().find("#detailedId").val());
			 }			 
		 })
		
		$(function(){
			var cod = ''+$('#code').val();
			var cid = 1;
			$.get(prefixd+"/select/"+cod,function(data){  //根据code查询清单，返回的data是个数组对象
				 for(var i=0;i<data.length;i++){
					 var detailedId = data[i].detailedId;					 
					 var product = data[i].product;
					 var worksName = data[i].worksName;					 
				 	 var price = data[i].price;	
				 	 var ghostWrite = data[i].ghostWrite;	 
				 	 var submitTime = data[i].submitTime; 
				 	 var deliveryTime = data[i].deliveryTime; 				 	 
				 	 var serialsNumber = data[i].serialsNumber;
				   	 var trackingNumber = data[i].trackingNumber;	
					 if(i==0){ 		
						$("#detailedId").val(detailedId);
						$("#product").val(product);
						$("#worksName").val(worksName);
					    $("#price").val(price);
					    $("#ghostWrite").val(ghostWrite);
					    $("#submitTime").val(submitTime);
					    $("#deliveryTime").val(deliveryTime);
					    $("#serialsNumber").val(serialsNumber);
					    $("#trackingNumber").val(trackingNumber);}
					   else{	    
					     var $cloneForm = $($('.detailForm')[0]).clone();	
		 				 $cloneForm.attr('id','#form-appDetailed-add'+cid);
		 				 cid++;	
		 				$('#detdiv').append($cloneForm);
		 				$cloneForm.find("#detailedId").val(detailedId);
		 				$cloneForm.find("#product").val(product);
		 				$cloneForm.find("#worksName").val(worksName);
		 				$cloneForm.find("#price").val(price);
		 				$cloneForm.find("#ghostWrite").val(ghostWrite);
		 				$cloneForm.find("#submitTime").val(submitTime);	
		 				$cloneForm.find("#deliveryTime").val(deliveryTime);	
		 				$cloneForm.find("#serialsNumber").val(serialsNumber);	
		 				$cloneForm.find("#trackingNumber").val(trackingNumber);		 				
					   }
				 }
			})
		});
	</script>
</body>
</html>
